<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title th:text="${title}"></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" th:href="@{/css/movieslist.css}">
</head>
<body>

<div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                 class="bi bi-camera-reels" viewBox="0 0 16 16" style = "color:white;">
                <path d="M6 3a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM1 3a2 2 0 1 0 4 0 2 2 0 0 0-4 0z"/>
                <path d="M9 6h.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 7.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 16H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h7zm6 8.73V7.27l-3.5 1.555v4.35l3.5 1.556zM1 8v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1z"/>
                <path d="M9 6a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM7 3a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
            </svg> |
            <a class="navbar-brand" href="#"> MyMovies | </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent" th:object="${movies}">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" th:href="@{/movies/user}"
                           data-bs-toggle="tooltip"
                           data-bs-placement="bottom"
                           title="Mi perfil">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-person-circle" viewBox="0 0 16 16">
                                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                                <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                            </svg> <span th:text="${user.UserName}"></span> </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/movies/all}"
                           data-bs-toggle="tooltip"
                           data-bs-placement="bottom" title="Listado de películas">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-film" viewBox="0 0 16 16">
                                <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zm4 0v6h8V1H4zm8 8H4v6h8V9zM1 1v2h2V1H1zm2 3H1v2h2V4zM1 7v2h2V7H1zm2 3H1v2h2v-2zm-2 3v2h2v-2H1zM15 1h-2v2h2V1zm-2 3v2h2V4h-2zm2 3h-2v2h2V7zm-2 3v2h2v-2h-2zm2 3h-2v2h2v-2z"/>
                            </svg> Películas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/tvseries/all}"
                           data-bs-toggle="tooltip"
                           data-bs-placement="bottom" title="Listado de series">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-tv" viewBox="0 0 16 16">
                                <path d="M2.5 13.5A.5.5 0 0 1 3 13h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zM13.991 3l.024.001a1.46 1.46 0 0 1 .538.143.757.757 0 0 1 .302.254c.067.1.145.277.145.602v5.991l-.001.024a1.464 1.464 0 0 1-.143.538.758.758 0 0 1-.254.302c-.1.067-.277.145-.602.145H2.009l-.024-.001a1.464 1.464 0 0 1-.538-.143.758.758 0 0 1-.302-.254C1.078 10.502 1 10.325 1 10V4.009l.001-.024a1.46 1.46 0 0 1 .143-.538.758.758 0 0 1 .254-.302C1.498 3.078 1.675 3 2 3h11.991zM14 2H2C0 2 0 4 0 4v6c0 2 2 2 2 2h12c2 0 2-2 2-2V4c0-2-2-2-2-2z"/>
                            </svg> Series</a>
                    </li>
                    <li class="nav-item dropdown"  data-bs-toggle="tooltip"
                        data-bs-placement="bottom" title="Listado de géneros">
                        <a class="nav-link dropdown-toggle" href="#" id="filtroGenero" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-funnel" viewBox="0 0 16 16">
                                <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2h-11z"/>
                            </svg> Géneros
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" th:href="@{/movies/all}">Limpiar filtro</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li th:each="g: ${moviesGenres}">
                                <a class="dropdown-item" th:value="${g.id}"  th:field="${g.name}"
                                   th:href="@{/movies/filter/{id}(id=${g.id})}"
                                   th:text="${g.name}"></a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-card-checklist" viewBox="0 0 16 16">
                                <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                                <path d="M7 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 1 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0zM7 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 0 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0z"/>
                            </svg> Mis Listas
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" th:href="@{/movies/user-movies}">Películas</a></li>
                            <li><a class="dropdown-item" th:href="@{/movies/user-series}">Series</a></li>
                            <li><hr class="dropdown-divider"></li>
                        </ul>
                    </li>
                    <li>
                        <form class="d-flex md-5">
                            <input class="form-control me-2 mt-2" type="search" placeholder="Buscar" aria-label="Buscar"
                                   style="height:30px;">
                            <button class="btn btn-outline-success btn-sm text-white mt-2"
                                    style="background-color:#A3BE8C;"
                                    type="submit">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                       fill="currentColor" class="bi bi-search mb-1"
                                                       viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            </button>
                        </form>
                    </li>
                </ul>

                    <a th:href="@{/user/login}" data-bs-toggle="tooltip"
                       data-bs-placement="bottom" title="Cerrar sesión">
                        <button class="btn btn-outline-danger btn-sm text-white" style="background-color:#BF616A;" >
                             Cerrar Sesión <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                            <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                        </svg></button>
                    </a>
            </div>
        </div>
    </nav>
</div>

<main class="bg-light" role="main">
    <div class="album py-5" style="background-color: #F4F7FD;">
        <div class="container">
            <div class="row">
                <div class="col-md-4" th:each="movie: ${movies}" th:object="${movie}">
                    <div id="card">
                        <a  th:href="@{/movies/detail/{id}(id=*{id})}" style="text-decoration: none;color: inherit;">
                            <div class="card mb-4 shadow p-3 mb-5 bg-body rounded" style="width: 25rem; height:30rem">
                                <div th:if="|${urlImage}${movie.backdrop_path}| != ''">
                                    <img class="card-img-top" th:src="|${urlImage}${movie.backdrop_path}|"
                                         alt="Imagen no disponible">
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title" th:text="*{title}"></h5>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item disabled"
                                                th:with="testString= *{release_date}"
                                                th:text="'Año de estreno: '+ ${testString.replaceFirst('-.*', '')}">
                                            </li>

                                            <li class="list-group-item disabled">
                                                <span th:each="a, g : *{genres}" th:text="${!g.last} ? ${a.name} + ',': ${a.name}"></span>&nbsp;
                                            </li>
                                            <li class="list-group-item">
                                                <span class="text-secondary">Puntuación:</span>
                                                <span class="badge circle circle-md text-white gradient-custom-5 mr-2" th:text="*{vote_average}"></span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="d-flex justify-content-end mt-3">

                                        <div th:each="m : ${user.watched_movies}" th:if="${m.id} == *{id}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                 fill="currentColor" class="bi bi-eye-fill text-success"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-placement="bottom" title="Vista"
                                                 viewBox="0 0 16 16">
                                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                                                <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                                            </svg>
                                        </div>

                                        <div th:each="m : ${user.favorite_movies}" th:if="${m.id} == *{id}">
                                            &nbsp;&nbsp;
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                 fill="currentColor" class="bi bi-heart-fill text-danger"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-placement="bottom" title="Favorita"
                                                 viewBox="0 0 16 16">
                                                <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                                            </svg>
                                        </div>

                                        <div th:each="m : ${user.pending_movies}" th:if="${m.id} == *{id}">
                                            &nbsp;&nbsp;
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                 fill="currentColor" class="bi bi-calendar2-check-fill text-primary"
                                                 viewBox="0 0 16 16"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-placement="bottom" title="Pendiente">
                                                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zm9.954 3H2.545c-.3 0-.545.224-.545.5v1c0 .276.244.5.545.5h10.91c.3 0 .545-.224.545-.5v-1c0-.276-.244-.5-.546-.5zm-2.6 5.854a.5.5 0 0 0-.708-.708L7.5 10.793 6.354 9.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"/>
                                            </svg>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-8">
                        <nav aria-label="Pagination" class="hidden-xs">
                            <ul class="pagination justify-content-center">
                                <li class="page-item"
                                    th:classappend="@{currentPage == 1 ? 'disabled' : ''}">
                                    <a  class="page-link text-secondary" th:href="@{'/movies/page/' + ${prevPage}}">Anterior</a>
                                </li>
                                <li class="page-item"
                                    th:each="i: ${#numbers.sequence(totalItems + 1, totalPages > 10 + totalItems ? totalItems + 10 : totalPages, 1 )}"
                                    th:classappend="${currentPage == i ? 'active' : ''} ">
                                    <a class="page-link" th:href="@{'/movies/page/' + ${i}}" th:text="${i}"></a>
                                </li>
                                <li class="page-item"
                                    th:classappend="@{current == totalPages ? 'disabled' : ''}">
                                    <a class="page-link text-secondary" th:href="@{'/movies/page/' + ${nextPage}}"
                                       th:text="Siguiente">Siguiente
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <p th:text="'Total Películas ' + ${totalItems} +' : '+ 'Página'+ ${currentPage}+' de '+ ${totalPages}"></p>
        </div>
    </div>

</main>

<footer th:insert="fragments :: footer"></footer>
<div th:insert="fragments :: scripts"></div>
</body>
</html>